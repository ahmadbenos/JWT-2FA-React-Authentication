/*! For license information please see main.3d68b67c.chunk.js.LICENSE.txt */
(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{139:function(e,t,a){},163:function(e,t){},165:function(e,t){},179:function(e,t){},181:function(e,t){},209:function(e,t){},211:function(e,t){},212:function(e,t){},217:function(e,t){},219:function(e,t){},238:function(e,t){},250:function(e,t){},253:function(e,t){},274:function(e,t,a){"use strict";a.r(t);var r=a(0),s=a(1),c=a(131),n=a.n(c),o=(a(139),a(8)),i=a(6),l=a(16),d=a(132),u=a.n(d),j=a(20),b=a.n(j),m=Object(s.createContext)(),h=function(){return Object(s.useContext)(m)},O=function(e){var t=e.children,a=Object(s.useState)({msg:"",status:""}),c=Object(o.a)(a,2),n=c[0],i=c[1],l=Object(s.useState)({user:"",status:"",two_fa_Validated:!1}),d=Object(o.a)(l,2),j=d[0],b=d[1],h=Object(s.useState)(!1),O=Object(o.a)(h,2),p=O[0],x=O[1],f=Object(s.useState)(""),g=Object(o.a)(f,2),v=g[0],y=g[1],N=Object(s.useState)(""),S=Object(o.a)(N,2),w=S[0],I=S[1],C={registerData:n,loggedInUser:j,changeCurrentUser:function(e){b(e)},changeRegisterData:function(e){i(e)},toggleLoading:function(e){x(e)},error:v,editError:function(e){y(e)},editSuccess:function(e){I(e)},success:w};return Object(r.jsx)(m.Provider,{value:C,children:!0===p?Object(r.jsx)("div",{className:"text-center mt-5",children:Object(r.jsx)(u.a,{type:"Puff",color:"black",height:80,width:80})}):t})},p=function(){var e=h(),t=(e.registerData,e.changeCurrentUser),a=e.toggleLoading,c=e.error,n=e.editError,d=e.success,u=e.editSuccess,j=Object(s.useState)(""),b=Object(o.a)(j,2),m=b[0],O=b[1],p=Object(s.useState)(""),x=Object(o.a)(p,2),f=x[0],g=x[1],v=Object(i.g)();return Object(r.jsxs)("div",{children:[Object(r.jsx)("br",{}),Object(r.jsxs)("form",{className:"border p-4 w-75 m-auto",onSubmit:function(e){a(!0),u(""),t({user:"",status:"",two_fa_Validated:!1}),e.preventDefault(),n(""),fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m,password:f})}).then((function(e){return e.json()})).then((function(e){console.log(e),"error"===e.status?n(e.message):(localStorage.setItem("myToken",e.token),localStorage.setItem("authed",e.message.secret),t({user:e.message,status:e.status,two_fa_Validated:!1}),e.message.secret?(console.log("has secret"),v.push("/user/validate")):(console.log("no secret"),v.push("/dashboard")))})).catch((function(e){console.log(e),n("Server error. Please try again")})).finally((function(){return a(!1)}))},children:[Object(r.jsx)("div",{className:"text-center mb-4",children:Object(r.jsx)("h2",{children:"Login"})}),d?Object(r.jsxs)("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[Object(r.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",children:Object(r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),d]}):null,c?Object(r.jsxs)("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[Object(r.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",children:Object(r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),c]}):null,Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{htmlFor:"exampleInputEmail1",children:"Email address"}),Object(r.jsx)("input",{type:"email",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",onChange:function(e){return O(e.target.value)}})]}),Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{htmlFor:"exampleInputPassword1",children:"Password"}),Object(r.jsx)("input",{type:"password",className:"form-control",id:"exampleInputPassword1",onChange:function(e){return g(e.target.value)}})]}),Object(r.jsx)("button",{type:"submit",className:"btn btn-primary btn-block",children:"Submit"})]}),Object(r.jsx)("div",{className:"text-center",children:Object(r.jsx)(l.b,{to:"/register",onClick:function(){n(""),u("")},children:"Don't have an account? Register Now!"})})]})},x=function(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("h1",{className:"display-3 text-center",children:"JWT+2FA"}),Object(r.jsxs)("div",{className:"text-center",children:[Object(r.jsx)("small",{className:"text-muted",children:"This is a mini project that uses JWT(route protection) and 2FA(more account security) authentication"}),Object(r.jsx)("p",{children:"by Ahmad Tarabein"}),Object(r.jsx)("a",{href:"https://github.com/ahmadbenos/JWT-2FA-React-Authentication",children:"Github repo link"})]})]})},f=function(){var e=h(),t=e.changeRegisterData,a=e.toggleLoading,c=e.editSuccess,n=e.error,d=e.editError,u=Object(s.useState)(""),j=Object(o.a)(u,2),b=j[0],m=j[1],O=Object(s.useState)(""),p=Object(o.a)(O,2),x=p[0],f=p[1],g=Object(s.useState)(""),v=Object(o.a)(g,2),y=v[0],N=v[1],S=Object(i.g)();return Object(r.jsxs)("div",{children:[Object(r.jsxs)("form",{className:"border p-4 w-75 m-auto",onSubmit:function(e){if(d(""),a(!0),e.preventDefault(),x!==y)return d("Passwords don't match!"),a(!1);fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b,password:x})}).then((function(e){return e.json()})).then((function(e){"error"===e.status?(d(e.msg),a(!1)):(c("Registeration Successful!"),S.push("/"),t(e),a(!1))})).catch((function(e){console.log(e),d("A server error occured. Please try again"),a(!1)}))},children:[Object(r.jsx)("div",{className:"text-center mb-4",children:Object(r.jsx)("h2",{children:"Register"})}),n?Object(r.jsx)("div",{className:"alert alert-danger",role:"alert",children:n}):null,Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{htmlFor:"exampleInputEmail1",children:"Email address"}),Object(r.jsx)("input",{type:"email",required:!0,className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",onChange:function(e){return m(e.target.value)}})]}),Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{htmlFor:"exampleInputPassword1",children:"Password"}),Object(r.jsx)("input",{required:!0,type:"password",className:"form-control",id:"exampleInputPassword1",onChange:function(e){return f(e.target.value)}})]}),Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{htmlFor:"exampleInputPassword2",children:"Confirm Password"}),Object(r.jsx)("input",{required:!0,type:"password",className:"form-control",id:"exampleInputPassword2",onChange:function(e){return N(e.target.value)}})]}),Object(r.jsx)("button",{type:"submit",className:"btn btn-primary btn-block",children:"Submit"})]}),Object(r.jsx)("div",{className:"text-center",children:Object(r.jsx)(l.b,{to:"/",onClick:function(){return d("")},children:"Login"})})]})},g=function(){var e=h(),t=e.loggedInUser,a=e.editSuccess,c=e.success,n=e.changeCurrentUser,o=Object(i.g)();return Object(s.useEffect)((function(){if(t.user)console.log("exist");else{var e=localStorage.getItem("myToken"),a=localStorage.getItem("authed");if(e){var r=b.a.decode(e,{complete:!0});n({user:{id:r.payload.id,email:r.payload.email,secret:a},status:"success",two_fa_Validated:!!a})}}}),[]),Object(r.jsx)("div",{className:"card",children:Object(r.jsxs)("div",{className:"card-body",children:[Object(r.jsx)("h2",{className:"text-center",children:"Dashboard"}),t.user.secret?null:Object(r.jsxs)("div",{className:"alert alert-warning alert-dismissible fade show",role:"alert",children:[Object(r.jsxs)("strong",{children:["You have not activated 2FA yet!"," ",Object(r.jsx)(l.b,{to:"/dashboard/2fa",children:"Please activate now for better account security"})," "]}),Object(r.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",children:Object(r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]}),c?Object(r.jsxs)("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[Object(r.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",children:Object(r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),c]}):null,Object(r.jsx)("p",{className:"text-center",style:{color:"blue",fontSize:24},children:t.user.email}),Object(r.jsx)("div",{className:"text-center",children:Object(r.jsx)("button",{className:"btn btn-outline-danger",onClick:function(){localStorage.removeItem("myToken"),localStorage.removeItem("authed"),localStorage.removeItem("didAuth"),a("Signed out successfully!"),o.push("/")},children:"Sign Out"})})]})})},v=(a(272),a(5)),y=a(46),N=function(e){var t=e.component,a=Object(y.a)(e,["component"]),s=h(),c=s.toggleLoading,n=s.editError;s.loggedInUser;function o(){c(!0),console.log(window.location.pathname);var e=localStorage.getItem("myToken"),t=localStorage.getItem("authed"),a=localStorage.getItem("didAuth");if(e){var r=b.a.decode(e,{complete:"true"}),s=new Date;return 1e3*r.exp<s?(localStorage.removeItem("myToken"),localStorage.removeItem("authed"),localStorage.removeItem("didAuth"),n("Please login to view this resource!"),c(!1),"error"):"/dashboard"===window.location.pathname&&!a&&t.length>3?(console.log("validate"),c(!1),"validate"):"/user/validate"===window.location.pathname&&a&&t.length>3?(console.log("dashboard"),c(!1),"dashboard"):(c(!1),"success")}return c(!1),n("Please login to view this resource!"),"error"}return"success"===o()?Object(r.jsx)(i.b,Object(v.a)(Object(v.a)({},a),{},{render:function(e){return Object(r.jsx)(t,Object(v.a)({},e))}})):"validate"===o()?Object(r.jsx)(i.b,Object(v.a)(Object(v.a)({},a),{},{render:function(e){return Object(r.jsx)(i.a,{to:"/user/validate"})}})):"dashboard"===o()?Object(r.jsx)(i.b,Object(v.a)(Object(v.a)({},a),{},{render:function(e){return Object(r.jsx)(i.a,{to:"/dashboard"})}})):Object(r.jsx)(i.b,Object(v.a)(Object(v.a)({},a),{},{render:function(e){return Object(r.jsx)(i.a,{to:"/"})}}))},S=function(e){var t=e.component,a=Object(y.a)(e,["component"]),s=h(),c=s.toggleLoading,n=s.changeCurrentUser;s.editError,s.editSuccess,s.error;return Object(r.jsx)(i.b,Object(v.a)(Object(v.a)({},a),{},{render:function(e){return"success"===function(){c(!0);var e=localStorage.getItem("myToken");if(localStorage.getItem("authed"),e){var t=b.a.decode(e,{complete:!0}),a=new Date;return console.log(t),1e3*t.payload.exp<a?(localStorage.removeItem("myToken"),localStorage.removeItem("authed"),localStorage.removeItem("didAuth"),c(!1),"error"):(n({user:{email:t.payload.email,id:t.payload.id},status:"success",two_fa_Validated:!0}),c(!1),"success")}return c(!1),"error"}()?Object(r.jsx)(i.a,{to:"/dashboard"}):Object(r.jsx)(t,Object(v.a)({},e))}}))},w=a(22),I=a.n(w),C=a(37),k=function(){var e=h(),t=e.loggedInUser,a=e.editSuccess,c=e.changeCurrentUser,n=Object(s.useState)(""),l=Object(o.a)(n,2),d=l[0],u=l[1],j=Object(s.useState)(""),b=Object(o.a)(j,2),m=b[0],O=b[1],p=Object(s.useState)(""),x=Object(o.a)(p,2),f=x[0],g=x[1],y=Object(i.g)(),N=function(){var e=Object(C.a)(I.a.mark((function e(){var t,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/2fa/activate");case 2:return t=e.sent,e.next=5,t.json();case 5:"success"===(a=e.sent).status&&u(a.tempSecret);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(C.a)(I.a.mark((function e(){var r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(""),e.next=3,fetch("/api/2fa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:d,userId:t.user.id,token:m})});case 3:return r=e.sent,e.next=6,r.json();case 6:e.sent.verified?(a("2FA activated successfully!"),localStorage.setItem("didAuth","true"),localStorage.setItem("authed",d),c(Object(v.a)(Object(v.a)({},t),{},{user:Object(v.a)(Object(v.a)({},t.user),{},{secret:d})})),y.push("/dashboard")):g("PIN is not correct! Try again.");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(s.useEffect)((function(){N()}),[]),Object(r.jsx)("div",{className:"card",children:Object(r.jsxs)("div",{className:"card-body",children:[Object(r.jsx)("h3",{className:"text-center",children:"2FA Activation"}),f?Object(r.jsxs)("div",{className:"alert alert-danger alert-dismissible fade show w-50 m-auto",role:"alert",children:[Object(r.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",children:Object(r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),f]}):null,Object(r.jsx)("p",{className:"text-center",children:"1- Please add the below secret key as a new user in your authenticator!"}),Object(r.jsx)("p",{className:"text-center",style:{color:"red",lineHeight:"0px"},children:"Make sure to keep the key private and safe"}),Object(r.jsx)("p",{className:"text-center",style:{fontSize:20},children:d}),Object(r.jsx)("p",{className:"text-center",children:"2- Input the PIN from your authenticator after adding the above secret key"}),Object(r.jsx)("div",{className:"text-center",children:Object(r.jsx)("input",{type:"number",placeholder:"PIN",className:"form-control w-25 m-auto text-center",required:!0,onChange:function(e){return O(e.target.value)},min:0})}),Object(r.jsx)("br",{}),Object(r.jsx)("div",{className:"text-center",children:Object(r.jsx)("button",{className:"btn btn-outline-primary",onClick:S,children:"Submit"})})]})})},P=function(){var e=h(),t=e.loggedInUser,a=e.changeCurrentUser,c=Object(s.useState)(),n=Object(o.a)(c,2),l=n[0],d=n[1],u=Object(s.useState)(""),j=Object(o.a)(u,2),m=j[0],O=j[1],p=Object(i.g)();function x(){return(x=Object(C.a)(I.a.mark((function e(){var r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(""),e.next=3,fetch("/api/2fa/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:t.user.secret,token:l})});case 3:return r=e.sent,e.next=6,r.json();case 6:e.sent.verified?(localStorage.setItem("authed",t.user.secret),localStorage.setItem("didAuth","true"),a(Object(v.a)(Object(v.a)({},t),{},{two_fa_Validated:!0})),p.push("/dashboard")):O("PIN is incorrect!");case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(s.useEffect)((function(){if(t.user)console.log("exist");else{var e=localStorage.getItem("myToken"),r=localStorage.getItem("authed");if(e){var s=b.a.decode(e,{complete:!0});a({user:{id:s.payload.id,email:s.payload.email,secret:r},status:"success",two_fa_Validated:!!r})}}}),[]),Object(r.jsx)("div",{className:"card",children:Object(r.jsxs)("div",{className:"card-body",children:[Object(r.jsx)("h3",{className:"text-center",children:"2FA Activation"}),m?Object(r.jsxs)("div",{className:"alert alert-danger alert-dismissible fade show w-50 m-auto",role:"alert",children:[Object(r.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",children:Object(r.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),m]}):null,Object(r.jsx)("p",{className:"text-center",children:"Input the PIN from your authenticator"}),Object(r.jsx)("div",{className:"text-center",children:Object(r.jsx)("input",{type:"number",placeholder:"PIN",className:"form-control w-25 m-auto text-center",required:!0,onChange:function(e){return d(e.target.value)},min:0})}),Object(r.jsx)("br",{}),Object(r.jsx)("div",{className:"text-center",children:Object(r.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){return x.apply(this,arguments)},children:"Submit"})})]})})};var T=function(){return Object(r.jsxs)("div",{className:"container",children:[Object(r.jsx)(x,{}),Object(r.jsx)(O,{children:Object(r.jsx)(l.a,{children:Object(r.jsxs)(i.d,{children:[Object(r.jsx)(S,{exact:!0,path:"/",component:p}),Object(r.jsx)(S,{path:"/register",component:f}),Object(r.jsx)(N,{exact:!0,path:"/dashboard",component:g}),Object(r.jsx)(N,{path:"/dashboard/2fa",component:k}),Object(r.jsx)(N,{path:"/user/validate",component:P})]})})})]})};n.a.render(Object(r.jsx)(T,{}),document.getElementById("root"))}},[[274,1,2]]]);
//# sourceMappingURL=main.3d68b67c.chunk.js.map